<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste das APIs</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        pre { background-color: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Teste das APIs do Anime Master</h1>
    
    <div class="test-section">
        <h2>1. Teste da API Jikan (MyAnimeList)</h2>
        <button onclick="testJikan()">Testar Jikan API</button>
        <button onclick="testJikanAnime(5114)">Testar Anime ID 5114</button>
        <button onclick="testJikanAnime(185407)">Testar Anime ID 185407 (problemático)</button>
        <div id="jikan-results"></div>
    </div>

    <div class="test-section">
        <h2>2. Teste da API Consumet (Streaming)</h2>
        <button onclick="testConsumet()">Testar Consumet API</button>
        <button onclick="testConsumetAnime('Fullmetal Alchemist: Brotherhood')">Testar Anime Específico</button>
        <div id="consumet-results"></div>
    </div>

    <div class="test-section">
        <h2>3. Teste de CORS</h2>
        <button onclick="testCORS()">Testar CORS</button>
        <div id="cors-results"></div>
    </div>

    <script>
        // Função para exibir resultados
        function displayResults(elementId, content, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<pre class="${type}">${JSON.stringify(content, null, 2)}</pre>`;
        }

        // Teste da API Jikan
        async function testJikan() {
            try {
                const response = await fetch('https://api.jikan.moe/v4/anime?q=naruto&limit=1');
                const data = await response.json();
                displayResults('jikan-results', { status: 'success', data: data }, 'success');
            } catch (error) {
                displayResults('jikan-results', { status: 'error', message: error.message }, 'error');
            }
        }

        async function testJikanAnime(id) {
            try {
                // Testar endpoint /full primeiro
                let response = await fetch(`https://api.jikan.moe/v4/anime/${id}/full`);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                const data = await response.json();
                displayResults('jikan-results', { status: 'success', endpoint: '/full', data: data }, 'success');
            } catch (error) {
                try {
                    // Fallback para endpoint básico
                    const response = await fetch(`https://api.jikan.moe/v4/anime/${id}`);
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    const data = await response.json();
                    displayResults('jikan-results', { status: 'success', endpoint: 'básico', data: data }, 'success');
                } catch (fallbackError) {
                    displayResults('jikan-results', { 
                        status: 'error', 
                        message: `Ambos endpoints falharam para ID ${id}`,
                        fullError: error.message,
                        fallbackError: fallbackError.message
                    }, 'error');
                }
            }
        }

        // Teste da API Consumet
        async function testConsumet() {
            const apis = [
                'https://api.consumet.org',
                'https://consumet-api-production-host.vercel.app',
                'https://consumet-api.vercel.app'
            ];

            for (const api of apis) {
                try {
                    const response = await fetch(`${api}/anime/gogoanime/test`);
                    if (response.ok || response.status === 404) {
                        displayResults('consumet-results', { 
                            status: 'success', 
                            workingAPI: api,
                            responseStatus: response.status 
                        }, 'success');
                        return;
                    }
                } catch (error) {
                    console.warn(`API ${api} falhou:`, error.message);
                }
            }
            
            displayResults('consumet-results', { 
                status: 'error', 
                message: 'Nenhuma API Consumet está funcionando' 
            }, 'error');
        }

        async function testConsumetAnime(title) {
            try {
                const workingAPI = 'https://api.consumet.org'; // Tentar a oficial primeiro
                const response = await fetch(`${workingAPI}/anime/gogoanime/${encodeURIComponent(title)}?page=1`);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                const data = await response.json();
                displayResults('consumet-results', { 
                    status: 'success', 
                    title: title,
                    data: data 
                }, 'success');
            } catch (error) {
                displayResults('consumet-results', { 
                    status: 'error', 
                    title: title,
                    message: error.message 
                }, 'error');
            }
        }

        // Teste de CORS
        async function testCORS() {
            const testUrls = [
                'https://api.jikan.moe/v4/anime?q=test',
                'https://api.consumet.org/anime/gogoanime/test',
                'https://consumet-api-production-host.vercel.app/anime/gogoanime/test'
            ];

            const results = [];
            for (const url of testUrls) {
                try {
                    const response = await fetch(url);
                    results.push({ url, status: 'success', statusCode: response.status });
                } catch (error) {
                    results.push({ url, status: 'error', message: error.message });
                }
            }

            displayResults('cors-results', { corsTest: results }, 'info');
        }
    </script>
</body>
</html>
